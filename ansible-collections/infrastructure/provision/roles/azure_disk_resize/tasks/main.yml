---
# tasks file for azure_disk_resize

  - name: Extend to fill all available space
    community.general.parted:
      device: /dev/sdb
      number: "{{ sdb_info.partitions | length }}"
      part_end: "100%"
      resize: true
      state: present

  - name: Resize volume group
    community.general.lvg:
      vg: rootvg
      pvs: /dev/sdb2

  - name: Resize partitions
    community.general.lvol:
      vg: rootvg
      lv: "{{ item }}"
      size: +20%FREE
    loop:
      - rootlv
      - tmplv
      - homelv
      - usrlv
      - varlv

  - name: Create a filesystem on top of a regular file
    community.general.filesystem:
      dev: "/dev/rootvg/{{ item }}"
      fstype: xfs
      resizefs: true
    loop:
      - rootlv
      - tmplv
      - homelv
      - usrlv
      - varlv
